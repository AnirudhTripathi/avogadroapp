set(APP_BUNDLE_PATH "${CPACK_TEMPORARY_INSTALL_DIRECTORY}/Avogadro2.app")

if (DEFINED ENV{CODESIGN_IDENTITY})
    set(COMMAND_ARGS
        codesign
        --force
        --deep
        --sign "$ENV{CODESIGN_IDENTITY}"
        ${APP_BUNDLE_PATH}
    )
    execute_process(COMMAND ${COMMAND_ARGS} RESULT_VARIABLE EXIT_CODE)
    if(NOT EXIT_CODE EQUAL 0)
        message(FATAL_ERROR
            \"Running ${COMMAND_ARGS} failed with exit code \${EXIT_CODE}.\")
    endif()
endif()